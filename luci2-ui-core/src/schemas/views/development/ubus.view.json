{
  "widget": "form",
  "events": { "onSetup": "_ = RxObject({})" },

  "content": [
    {
      "widget": "autocomplete",
      "bind": "_.service",
      "options": {
        "title": "Service",
        "description": "Ubus service",
        "enum=": "ubusList()"
      }
    },
    {
      "widget": "autocomplete",
      "bind": "_.method",
      "options": {
        "title": "Method",
        "description": "Ubus method",
        "enum=": "Object.keys(ubusList([_.service])[_.service] || {})"
      }
    },
    {
      "widget": "input",
      "bind": "_.params",
      "options": {
        "title": "Parameters",
        "description=": "JSON.stringify(ubusList([_.service])[_.service][_.method])"
      }
    },
    {
      "widget": "input",
      "bind": "_.path",
      "options": {
        "title": "jsonPath filter",
        "description": "Transformation to apply to result"
      }
    },
    {
      "widget": "input",
      "bind": "_.errorVal",
      "options": {
        "title": "error values",
        "description": "Transformation to apply to error codes"
      }
    },
    {
      "widget": "button",
      "options": { "title": "Execute" },
      "events": {
        "onClick": [
          "_.result = ubus(_.service, _.method, ",
          "  _.params.trim() ? JSON.parse(_.params) : {}, ",
          "  _.path, _.errorVal && JSON.parse(_.errorVal))"
        ]
      }
    },
    {
      "widget": "code",
      "options": {
        "text=": [
          "`ubus('${_.service}', '${_.method}', ${",
          "JSON.stringify(JSON.parse(_.params.trim()) || {})}${",
          "_.path  ? `, '${_.path}'` :  _.errorVal ? `, ${_.path}` : ''}${",
          "_.errorVal ? `, ${JSON.stringify(JSON.parse(_.errorVal))}` : ''})`"
        ]
      }
    },
    {
      "widget": "code",
      "options": {
        "text=": "JSON.stringify(_.result, null, 4)"
      }
    }
  ]
}
